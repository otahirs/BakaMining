@using ProcessM.NET.Model

<MudDialog>
    <DialogContent>
            <MudForm @bind-IsValid="@form.IsValid">
                <MudSelect T="string" Label="CaseId" AnchorOrigin="Origin.BottomCenter" Required="true" @bind-Value=@form.caseId>
                    @foreach (var it in Log.Contents.ColumnKeys)
                    {
                        <MudSelectItem Value="@(it)"/>
                    }
                </MudSelect>
                <MudSelect T="string" Label="Activity" AnchorOrigin="Origin.BottomCenter" Required="true" @bind-Value=@form.activity>
                    @foreach (var it in Log.Contents.ColumnKeys)
                    {
                        <MudSelectItem Value="@(it)"/>
                    }
                </MudSelect>
                
                <MudSwitch Label="Timestamp" @bind-Checked="@form.hasTimestamp" Color="Color.Primary" />
                @if (form.hasTimestamp){
                    <MudSelect T="string" Label="Timestamp" AnchorOrigin="Origin.BottomCenter" @bind-Value=@form.timestamp>
                        @foreach (var it in Log.Contents.ColumnKeys)
                        {
                            <MudSelectItem Value="@(it)"/>
                        }
                    </MudSelect>
                }
            </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!form.IsValid)" Class="ml-auto" OnClick="SetColumns">Confirm</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    
    [Parameter]
    public ImportedEventLog Log { get; set; }
    Form form;
    
    public struct Form
    {
        public bool IsValid = false;
        public string activity = String.Empty;
        public string caseId = String.Empty;
        public string timestamp = String.Empty;
        public bool hasTimestamp = false;
    }

    private void SetColumns()
    {
        Log.SetActivity(form.activity);
        Log.SetCaseId(form.caseId);
        if (form.hasTimestamp)
        {
            Log.SetTimestamp(form.timestamp);
        }
        MudDialog.Close(DialogResult.Ok(true));
    }
}